jar{
    manifest{
        attributes 'Main-Class': 'bupt.sse.hadoop.cfrs.itemcf.Main'
    }
}

ext{
    OUTPUT_JAR = "build/libs/${project.name}-all.jar"
    HDFS_OUTPUT_DIR = "${PROJECT_HDFS_OUTPUT_DIR}/ItemCF"
}

task buildAndRun(dependsOn: 'shadowJar'){
    doLast{
        try {
            exec{
                commandLine "${HADOOP_HOME}/bin/hdfs", 'dfs', '-rm', '-r', HDFS_OUTPUT_DIR
            }
        }catch (Exception ignore){}

        exec{
            commandLine "${HADOOP_HOME}/bin/hdfs", 'dfs', '-mkdir', '-p', HDFS_OUTPUT_DIR
        }

        exec{
            commandLine "${HADOOP_HOME}/bin/hadoop", 'jar', OUTPUT_JAR
        }
    }
}